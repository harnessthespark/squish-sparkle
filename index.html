<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Squish & Sparkle">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#FFE4EC">
<link rel="manifest" href="manifest.json">
<title>Squish & Sparkle</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#FFE4EC;min-height:100vh;overflow-x:hidden}
.app{max-width:420px;margin:0 auto;padding:16px;padding-bottom:40px;position:relative;z-index:1}

/* Floating sparkles */
.sparkle-bg{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;overflow:hidden;z-index:0}
.sparkle-float{position:absolute;animation:floatUp linear infinite;opacity:0}
@keyframes floatUp{0%{transform:translateY(110vh) rotate(0deg);opacity:0}10%{opacity:.6}80%{opacity:.6}100%{transform:translateY(-10vh) rotate(360deg);opacity:0}}

/* Background blobs */
.blob{position:fixed;border-radius:50%;pointer-events:none;z-index:0}
.blob1{top:5%;left:-30px;width:180px;height:180px;background:rgba(255,182,193,.2);animation:blobPulse 8s ease-in-out infinite}
.blob2{top:45%;right:-40px;width:150px;height:150px;background:rgba(201,160,220,.15);animation:blobPulse 10s ease-in-out infinite 2s}
.blob3{bottom:10%;left:-20px;width:120px;height:120px;background:rgba(255,215,0,.1);animation:blobPulse 7s ease-in-out infinite 4s}
@keyframes blobPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}

/* Squishmallow CSS character */
.squish{position:relative;display:inline-block}
.squish-body{border-radius:48%;display:flex;align-items:center;justify-content:center;flex-direction:column;border:2px solid rgba(255,255,255,.5);position:relative;overflow:visible}
.squish-body.pink{background:#FFB6D9;box-shadow:0 4px 15px rgba(255,182,217,.5)}
.squish-body.purple{background:#C9A0DC;box-shadow:0 4px 15px rgba(201,160,220,.5)}
.squish-cheek{position:absolute;border-radius:50%;background:rgba(255,150,180,.4)}
.squish-eye{border-radius:50%;background:#4A3040;position:relative}
.squish-eye::after{content:'';position:absolute;top:15%;left:20%;width:30%;height:30%;border-radius:50%;background:white}
.squish-smile{border:0 solid transparent;border-bottom:2.5px solid #4A3040;border-left:2.5px solid #4A3040;border-right:2.5px solid #4A3040;border-bottom-left-radius:50%;border-bottom-right-radius:50%}
.squish-sparkle{position:absolute;top:-5%;right:8%;font-size:inherit}
.squish-lg .squish-body{width:90px;height:76px}
.squish-lg .squish-eye{width:9px;height:11px}
.squish-lg .squish-eyes{display:flex;gap:16px;margin-top:-4px}
.squish-lg .squish-smile{width:18px;height:9px;margin-top:3px}
.squish-lg .squish-cheek{width:14px;height:9px}
.squish-lg .squish-cheek.l{left:9%;top:44%}
.squish-lg .squish-cheek.r{right:9%;top:44%}
.squish-lg .squish-sparkle{font-size:14px}
.squish-xl .squish-body{width:110px;height:93px}
.squish-xl .squish-eye{width:11px;height:13px}
.squish-xl .squish-eyes{display:flex;gap:20px;margin-top:-5px}
.squish-xl .squish-smile{width:22px;height:11px;margin-top:4px}
.squish-xl .squish-cheek{width:17px;height:11px}
.squish-xl .squish-cheek.l{left:9%;top:44%}
.squish-xl .squish-cheek.r{right:9%;top:44%}
.squish-xl .squish-sparkle{font-size:16px}
.squish-sm .squish-body{width:55px;height:47px}
.squish-sm .squish-eye{width:5px;height:6px}
.squish-sm .squish-eyes{display:flex;gap:10px;margin-top:-2px}
.squish-sm .squish-smile{width:11px;height:5px;margin-top:2px}
.squish-sm .squish-cheek{width:8px;height:5px}
.squish-sm .squish-cheek.l{left:10%;top:44%}
.squish-sm .squish-cheek.r{right:10%;top:44%}
.squish-sm .squish-sparkle{font-size:9px}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes squishPop{0%{transform:scale(1)}50%{transform:scale(1.15) rotate(3deg)}100%{transform:scale(1)}}
.squish-bounce{animation:bounce 3s ease-in-out infinite}
.squish-pop{animation:squishPop .4s ease-in-out}

/* Glow rings */
.char-glow{background:rgba(255,182,193,.25);border-radius:50%;padding:12px;border:2px solid rgba(255,105,180,.2);display:inline-flex}
.char-glow-princess{background:rgba(201,160,220,.25);border-radius:50%;padding:12px;border:2px solid rgba(155,89,182,.2);display:inline-flex;align-items:center;justify-content:center}

.sparkle-counter{position:fixed;top:16px;right:16px;background:#FF69B4;border-radius:20px;padding:6px 14px;color:#fff;font-weight:bold;font-size:15px;z-index:10}
.streak-badge{position:fixed;top:16px;left:16px;background:#FFD700;border-radius:20px;padding:6px 12px;color:#5D4E37;font-weight:bold;font-size:14px;z-index:10}
.char-row{display:flex;justify-content:center;gap:30px;margin-top:50px;margin-bottom:10px}
.char-wrap{text-align:center;cursor:pointer;user-select:none}
.char-name{font-size:13px;font-weight:bold;color:#8B4A6B;margin-top:4px}
.princess-emoji{font-size:50px;display:block}
.bubble{background:#fff;border-radius:18px;padding:14px;margin:12px 20px 0;border:2px solid #FFB6C1;box-shadow:0 2px 8px rgba(0,0,0,.08);text-align:center;font-size:15px;color:#5D4E37;line-height:22px}
.bubble-trim{font-size:8px;text-align:center;margin:4px 0;opacity:.7}
.hint{text-align:center;color:#B8A0C8;font-size:13px;margin:8px 0 12px}
.needs-card{background:rgba(255,255,255,.85);border-radius:16px;padding:14px;box-shadow:0 2px 8px rgba(0,0,0,.08);backdrop-filter:blur(4px)}
.needs-title{font-size:14px;color:#8B4A6B;text-align:center;margin-bottom:10px}
.needs-row{display:flex;justify-content:space-around}
.need-item{text-align:center;padding:6px;cursor:pointer}
.need-icon{font-size:22px}
.need-label{font-size:11px;color:#888;margin-top:2px}
.need-bar{width:36px;height:5px;background:#eee;border-radius:3px;margin:4px auto 0;overflow:hidden}
.need-fill{height:100%;background:#FF69B4;border-radius:3px;transition:width .3s}
.act-grid{display:flex;flex-wrap:wrap;justify-content:space-between;margin-top:16px}
.act-card{width:48%;background:rgba(255,255,255,.85);border-radius:18px;padding:18px;text-align:center;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.07);cursor:pointer;transition:transform .15s;backdrop-filter:blur(4px)}
.act-card:active{transform:scale(.95)}
.act-icon-wrap{width:52px;height:52px;background:rgba(255,105,180,.08);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 4px}
.act-icon{font-size:28px}
.act-label{font-size:13px;font-weight:600;color:#8B4A6B}
.footer-wrap{text-align:center;margin-top:20px}
.footer{color:#8B4A6B;opacity:.6;font-size:12px;line-height:18px}
.footer-sparkle{font-size:10px;margin-bottom:4px;opacity:.7}
.btn-pink{background:#FF69B4;border:none;border-radius:14px;padding:14px 24px;color:#fff;font-weight:bold;font-size:15px;cursor:pointer;margin-top:14px;width:100%;transition:transform .15s}
.btn-pink:active{transform:scale(.95)}
.btn-purple{background:#9B59B6;border:none;border-radius:14px;padding:14px 24px;color:#fff;font-weight:bold;font-size:15px;cursor:pointer;margin-top:14px;width:100%;transition:transform .15s}
.btn-purple:active{transform:scale(.95)}
.back-btn{margin-bottom:10px;padding:8px 14px;background:rgba(255,255,255,.85);border:none;border-radius:12px;color:#8B4A6B;font-weight:600;font-size:14px;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.sec-header{text-align:center;margin-bottom:16px}
.sec-title{font-size:20px;font-weight:bold;color:#8B4A6B;display:inline}
.sec-divider{display:flex;align-items:center;justify-content:center;gap:8px}
.sec-line{height:2px;width:30px;background:#FFB6C1;border-radius:1px}
.sec-ornament{font-size:8px;text-align:center;margin-top:6px;opacity:.5}
.sub-txt{text-align:center;color:#8B4A6B;margin-bottom:12px;font-size:14px}
.card{background:rgba(255,255,255,.85);border-radius:16px;padding:18px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.06);backdrop-filter:blur(4px)}
.setup-wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:80vh;padding:30px;position:relative;z-index:1}
.setup-title{font-size:28px;font-weight:bold;color:#8B4A6B;margin-top:20px}
.setup-sub{font-size:15px;color:#B07A9E;margin-top:8px;margin-bottom:25px}
.setup-input{width:80%;padding:14px;border:3px solid #FFB6C1;border-radius:15px;font-size:16px;text-align:center;background:#fff;color:#8B4A6B;outline:none}
.setup-input::placeholder{color:#cba}
.setup-deco{font-size:10px;opacity:.5}
.mood-grid{display:flex;flex-wrap:wrap;justify-content:center;gap:10px}
.mood-btn{background:rgba(255,255,255,.85);border:2px solid #FFB6C1;border-radius:14px;padding:12px;text-align:center;min-width:70px;cursor:pointer;transition:transform .15s}
.mood-btn:active{transform:scale(.9)}
.mood-emoji{font-size:28px}
.mood-lbl{font-size:11px;color:#8B4A6B;margin-top:4px}
.text-area{width:100%;border:2px solid #C9A0DC;border-radius:14px;padding:14px;font-size:15px;background:#fff;min-height:90px;resize:vertical;font-family:inherit;outline:none;color:#5D4E37}
.text-area::placeholder{color:#B8A0C8}
.worry-msg{font-size:16px;color:#8B4A6B;text-align:center;margin-top:14px;line-height:24px}
.breath-txt{font-size:22px;font-weight:bold;color:#5B7DB1;text-align:center;min-height:34px}
.breath-dots{display:flex;justify-content:center;gap:10px;margin:16px 0}
.dot{width:14px;height:14px;border-radius:7px;background:#ccc;transition:all .3s}
.dot.done{background:#5B7DB1;transform:scale(1.2)}
.mentor-qt{font-size:16px;color:#8B4A6B;font-style:italic;line-height:24px;text-align:center}
.glam-q{font-size:15px;color:#5D4E37;text-align:center;margin-bottom:14px;line-height:22px}
.glam-grid{display:flex;flex-wrap:wrap;gap:8px}
.glam-opt{width:47%;padding:14px;background:#f8f8f8;border:2px solid #eee;border-radius:12px;text-align:center;cursor:pointer;font-size:16px;font-weight:600;color:#5D4E37;transition:transform .15s}
.glam-opt:active{transform:scale(.95)}
.result-txt{text-align:center;font-size:15px;font-weight:bold;color:#8B4A6B;margin-top:12px}
.hint-txt{text-align:center;color:#666;font-style:italic;margin-bottom:12px}
.answer-row{display:flex;justify-content:center;gap:4px;margin-bottom:14px}
.ans-slot{width:32px;height:38px;background:#f0f0f0;border:2px dashed #ccc;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:bold}
.letter-row{display:flex;flex-wrap:wrap;justify-content:center;gap:6px}
.letter-tile{width:38px;height:38px;background:#fff;border:2px solid #9B59B6;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:bold;color:#9B59B6;cursor:pointer;transition:transform .15s}
.letter-tile:active{transform:scale(.9)}
.letter-tile.used{opacity:.25;pointer-events:none}
.story-start{font-size:14px;color:#5D4E37;line-height:22px;font-style:italic;margin-bottom:12px}
.secret-count{text-align:center;color:#B8860B;margin-bottom:10px;font-size:13px}
.secret-txt{font-size:15px;color:#5D4E37;line-height:23px;text-align:center}
.quest-txt{text-align:center;color:#8B4A6B;margin-bottom:10px;font-size:14px}
.btn-row{display:flex;gap:10px}
.btn-row .btn-pink,.btn-row .btn-purple{flex:1}
.prog-outer{height:12px;background:rgba(255,105,180,.15);border-radius:8px;margin:0 30px;overflow:hidden}
.prog-fill{height:100%;background:#FF69B4;border-radius:8px;transition:width .3s}
.prog-lbl{text-align:center;font-size:12px;color:#8B4A6B;margin:4px 0 14px}
.sats-grid{display:flex;flex-wrap:wrap;justify-content:space-between}
.sats-card{width:48%;background:rgba(255,255,255,.85);border-radius:16px;padding:14px;margin-bottom:10px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.06);cursor:pointer;transition:transform .15s}
.sats-card:active{transform:scale(.95)}
.sats-icon{font-size:30px}
.sats-nm{font-size:13px;font-weight:700;color:#8B4A6B;margin-top:4px;white-space:pre-line}
.sats-cnt{font-size:10px;color:#999;margin:2px 0 6px}
.sats-bar-o{height:5px;width:100%;background:rgba(255,105,180,.15);border-radius:3px;overflow:hidden}
.sats-bar-f{height:100%;border-radius:3px;transition:width .3s}
.sats-pct{font-size:10px;color:#8B4A6B;margin-top:2px}
.topic-card{background:rgba(255,255,255,.85);border-radius:16px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.06);overflow:hidden}
.topic-row{display:flex;align-items:center;padding:12px;gap:8px}
.chk{width:22px;height:22px;border-radius:6px;border:2px solid #ddd;background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0}
.chk.done{background:#FF69B4;border-color:#FF69B4}
.chk-mark{color:#fff;font-size:13px;font-weight:bold}
.topic-nm{flex:1;font-size:14px;font-weight:600;color:#8B4A6B}
.topic-nm.done-txt{text-decoration:line-through;opacity:.4}
.notes-btn{background:#FFF0F5;border-radius:8px;padding:3px 8px;border:1px solid #FFB6C1;cursor:pointer;font-size:11px;color:#8B4A6B}
.notes-panel{padding:0 14px 12px 42px}
.note-txt{font-size:13px;color:#5D4E37;line-height:20px;margin-bottom:2px}
.tip-box{background:rgba(255,105,180,.08);border-left:3px solid #FF69B4;border-radius:8px;padding:10px;margin-top:6px}
.tip-txt{font-size:13px;color:#8B4A6B;line-height:19px}
.conf-row{display:flex;flex-wrap:wrap;gap:5px;margin-top:8px}
.conf-btn{padding:4px 7px;border-radius:7px;border:2px solid #eee;background:#fff;cursor:pointer;font-size:10px}
</style>
</head>
<body>

<!-- Background decorations -->
<div class="sparkle-bg" id="sparkleBg"></div>
<div class="blob blob1"></div>
<div class="blob blob2"></div>
<div class="blob blob3"></div>

<div class="app" id="app"></div>
<script>
const STORAGE_KEY='squish-sparkle-app',SATS_KEY='sylvie-sats';
const pick=a=>a[Math.floor(Math.random()*a.length)];
const shuffle=a=>[...a].sort(()=>Math.random()-.5);
const esc=s=>s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');

// Floating sparkles
(function(){
  const chars=['‚ú®','‚≠ê','üíñ','üåü','üí´','ü¶ã','üå∏'];
  const bg=document.getElementById('sparkleBg');
  for(let i=0;i<12;i++){
    const s=document.createElement('div');
    s.className='sparkle-float';
    s.textContent=chars[i%chars.length];
    s.style.left=Math.random()*100+'%';
    s.style.fontSize=(10+Math.random()*14)+'px';
    s.style.animationDuration=(6+Math.random()*8)+'s';
    s.style.animationDelay=(Math.random()*8)+'s';
    bg.appendChild(s);
  }
})();

// Squishmallow HTML builder
function squishHTML(size,color,extraClass){
  const cls=size==='xl'?'squish-xl':size==='sm'?'squish-sm':'squish-lg';
  const bodyColor=color==='purple'?'purple':'pink';
  return '<div class="squish '+cls+' '+(extraClass||'')+'"><div class="squish-body '+bodyColor+'"><div class="squish-cheek l"></div><div class="squish-cheek r"></div><div class="squish-eyes"><div class="squish-eye"></div><div class="squish-eye"></div></div><div class="squish-smile"></div><div class="squish-sparkle">‚ú®</div></div></div>';
}

function secHeader(icon,title){
  return '<div class="sec-header"><div class="sec-divider"><div class="sec-line"></div><span class="sec-title">'+icon+' '+title+'</span><div class="sec-line"></div></div><div class="sec-ornament">‚ú® üíñ ‚ú®</div></div>';
}

const mentorQuotes=["You are absolutely gorgeous inside and out, and don't you ever forget it!","Confidence looks beautiful on you, babe!","You don't need anyone's approval to be amazing - you already are!","Every single person has their own kind of sparkle, and yours is stunning!","Bad days don't make you a bad person. They make you human, and that's beautiful!","You're not too much. You're exactly enough. The right people will see that!","Your vibe attracts your tribe - keep shining, gorgeous!","It's okay to not have it all figured out. Nobody does, trust me!","Self-care isn't selfish, it's necessary. Look after yourself, queen!","You are worthy of love and kindness - especially from yourself!","Comparison is the thief of joy. Your journey is YOUR journey!","Being yourself is your superpower. Use it!","You're stronger than you know, braver than you believe!","Your feelings are valid. Every. Single. One.","Progress, not perfection. You're doing amazing!","The world needs what YOU have to offer. Don't hide your light!","Dream big, sparkle more, shine bright!"];

const squishSayings=["*happy squish bounce* I love you! üíï","You're the best! *snuggle*","*soft squeeze* You make me so happy!","I'm always here for cuddles! üíï","*bounces excitedly* Yay, it's you!","You're my favourite person! üíï","*cosy snuggle* Everything's gonna be okay!"];

const glamQuestions=[{q:"You have 12 lipsticks and give 4 to your friend. How many left?",a:8,options:[6,8,10,7]},{q:"Each palette has 6 colours. You have 3 palettes. How many colours?",a:18,options:[15,18,21,12]},{q:"Nail polish costs \u00A35. How much for 4 bottles?",a:20,options:[15,20,25,18]},{q:"You need 2 cotton pads per eye. How many for 5 makeovers?",a:20,options:[15,20,25,10]},{q:"Your collection has 15 items. Buy 7 more. How many now?",a:22,options:[20,22,25,21]},{q:"A face mask takes 15 mins. How long for 3 masks?",a:45,options:[30,45,60,40]},{q:"24 hair clips shared between 4 friends. How many each?",a:6,options:[4,6,8,5]},{q:"Lip gloss \u00A33 and mascara \u00A37. How much for both?",a:10,options:[9,10,11,8]},{q:"10 nails with 2 coats each. Total coats?",a:20,options:[15,20,25,12]},{q:"30 Squishmallows, display half. How many on display?",a:15,options:[10,15,20,12]}];

const puzzleWords=[{word:"GLITTER",hint:"Sparkly stuff for crafts"},{word:"SPARKLE",hint:"To shine brightly"},{word:"SQUISH",hint:"What your soft friend does"},{word:"FLUFFY",hint:"Soft and cuddly"},{word:"CUDDLE",hint:"A warm, cosy hug"},{word:"SHIMMER",hint:"A soft, pretty glow"},{word:"GLOW",hint:"To shine softly"},{word:"COSY",hint:"Warm and comfortable"},{word:"SHINE",hint:"To be bright and glossy"},{word:"BEAUTY",hint:"Looking and feeling lovely"},{word:"CHARM",hint:"Something lovely and delightful"},{word:"SNUGGLE",hint:"To cuddle up close"}];

const storyStarters=["SQUISH was having a cosy day when a tiny glittering envelope appeared on the windowsill...","At the Squishmallow sleepover, SQUISH noticed something magical in the garden...","SQUISH found a mysterious pink door that had never been there before. Behind it was...","One sparkly morning, SQUISH discovered they could grant one wish. They decided to...","SQUISH and their best friend found a map to the legendary Glitter Grotto...","A new Squishmallow arrived in town with a secret. SQUISH was determined to help...","SQUISH woke up to find everything had turned pink and sparkly overnight...","The glitter jar spilled and something magical started to grow...","A shooting star landed in SQUISH's garden, and out stepped..."];

const squishSecrets=["Squishmallows were first created in 2017 and became super popular because everyone loves their squishy softness! ‚ú®","There are over 1,000 different Squishmallow characters! Each one has their own name and personality! üéÇ","The rarest Squishmallows can be worth hundreds of pounds to collectors! üíé","Smiling releases chemicals that make you feel happier - even if you're faking it at first! üòä","Your brain can't tell the difference between a real hug and hugging a soft toy - both release feel-good hormones! ü§ó","Colours affect your mood! Pink is calming, yellow is energising, blue helps you focus! üåà","Being kind to others actually makes YOU feel happier too - kindness is a two-way sparkle! ‚ú®","Everyone feels worried sometimes - it's your brain trying to protect you! üß†","Getting enough sleep helps your brain recharge and even helps your skin! üí§"];

const moods=[{key:'happy',emoji:'üòä',label:'Happy',response:'Yay! That makes me so happy too! üéâ'},{key:'calm',emoji:'üòå',label:'Calm',response:"That's so peaceful üå∏"},{key:'worried',emoji:'üòü',label:'Worried',response:"*gives you a big squishy hug* I'm here üíï"},{key:'sad',emoji:'üò¢',label:'Sad',response:"*snuggles close* It's okay to feel this way üíï"},{key:'angry',emoji:'üò†',label:'Angry',response:"Those feelings are totally valid. I'm here üíï"},{key:'tired',emoji:'üò¥',label:'Tired',response:'Rest is so important. Calm breathing? üí§'},{key:'anxious',emoji:'üò∞',label:'Anxious',response:"*soft squeeze* Moment by moment üåà"},{key:'excited',emoji:'ü§©',label:'Excited',response:'Ooh exciting! Tell me everything! ‚ú®'}];

const SATS_SUBJECTS=[
{id:'ma',name:'Maths Arithmetic',icon:'‚ûï',color:'#FF69B4',topics:[{name:'Place Value',notes:['Numbers up to 10,000,000','Value of each digit','Rounding','Negative numbers'],tip:'Place value chart: M, HTh, TTh, Th, H, T, O.'},{name:'Addition & Subtraction',notes:['Column addition with carrying','Column subtraction with exchanging','Decimals','Inverse operations'],tip:'Line up decimal points!'},{name:'Multiplication',notes:['Times tables to 12x12','Long multiplication','Multiplying decimals','x10, x100, x1000'],tip:'Zero placeholder on second row!'},{name:'Division',notes:['Bus stop method','Long division','Remainders as fractions/decimals','div 10, div 100, div 1000'],tip:'Divide, multiply, subtract, bring down!'},{name:'Fractions',notes:['Equivalent fractions','Simplify','Add & subtract','Multiply & divide'],tip:'Common denominator = LCM.'},{name:'Decimals & %',notes:['Fractions to decimals','Decimals to %','1/2=50%, 1/4=25%, 1/10=10%','% of amounts'],tip:'10%=div 10, 5%=half of 10%.'},{name:'BODMAS',notes:['Brackets','Orders','Division & Multiplication','Addition & Subtraction'],tip:'Brackets first!'}]},
{id:'mr',name:'Maths Reasoning',icon:'üß©',color:'#C9A0DC',topics:[{name:'Ratio & Proportion',notes:['Share in a ratio','Scale factors','One part method'],tip:'Find one part first.'},{name:'Algebra',notes:['Missing numbers','Simple formulae','Sequences','e.g. 2a+3=11'],tip:'Use inverse operations.'},{name:'Measurement',notes:['Convert units','Perimeter & area','Compound shapes','Volume of cuboids'],tip:'Split compound shapes into rectangles.'},{name:'Shapes & Angles',notes:['2D properties','Triangle=180 deg','Straight line=180 deg','Protractor use'],tip:'Check inner/outer scale.'},{name:'Statistics',notes:['Charts & graphs','Calculate mean','Data problems'],tip:'Pie chart = 360 deg.'},{name:'Word Problems',notes:['Read twice','Underline key info','Show working','Check answer'],tip:'RUCSAC method.'}]},
{id:'er',name:'English Reading',icon:'üìñ',color:'#5B7DB1',topics:[{name:'Retrieval',notes:['Find & copy','Info directly stated','Scan for key words'],tip:'Underline key words first.'},{name:'Inference',notes:['What is suggested','Evidence from text','PEE method'],tip:'Point, Evidence, Explain.'},{name:'Vocabulary',notes:['Meaning from context','Synonyms that fit'],tip:'Swap the word - still make sense?'},{name:'Summarising',notes:['Main idea','Events in order','Key points only'],tip:'One sentence per paragraph.'},{name:'Prediction',notes:['Clues from text','Based on evidence'],tip:'"I think... because the text says..."'},{name:"Author's Language",notes:['Why that word?','Effect on reader','Techniques'],tip:'"The author uses [X] to make the reader feel..."'}]},
{id:'eg',name:'Grammar & Spelling',icon:'‚úèÔ∏è',color:'#FFB347',topics:[{name:'Word Classes',notes:['Nouns, verbs, adjectives','Adverbs, pronouns','Prepositions, conjunctions'],tip:"Remove it - what's missing?"},{name:'Sentence Types',notes:['Statement, question','Command, exclamation'],tip:'Exclamation = What/How + verb + !'},{name:'Clauses',notes:['Main clause','Subordinate clause','Relative clause'],tip:'Alone = main. Needs help = subordinate.'},{name:'Punctuation',notes:['Commas','Apostrophes','Speech marks','Colons & semi-colons'],tip:"it's = it is. its = belonging to it."},{name:'Tenses',notes:['Simple past & present','Progressive','Perfect'],tip:'Perfect = have/has + past participle.'},{name:'Active & Passive',notes:['Active: cat chased mouse','Passive: mouse was chased'],tip:'"By zombies" test = passive!'},{name:'Spelling',notes:['Silent letters','Homophones','Prefixes & suffixes'],tip:'Look, cover, write, check x3.'}]},
{id:'sc',name:'Science',icon:'üî¨',color:'#7EC8A0',topics:[{name:'Living Things',notes:['Classification','Vertebrates & invertebrates','Life cycles'],tip:'Mammals: warm-blooded, hair, milk.'},{name:'Animals & Humans',notes:['Circulatory system','Diet & health','Digestive system'],tip:'Heart has 4 chambers.'},{name:'Evolution',notes:['Inheritance','Adaptation','Natural selection','Fossils'],tip:'Adaptation + time = evolution.'},{name:'Materials',notes:['Properties','Dissolving','Reversible vs irreversible'],tip:'Get it back? Reversible.'},{name:'Earth & Space',notes:['Day/night','Seasons','Planets in order'],tip:'My Very Excited Mum Just Served Us Nachos.'},{name:'Forces',notes:['Gravity','Friction','Air resistance','Levers & pulleys'],tip:'Parachute = more air resistance.'},{name:'Light & Sound',notes:['Light: straight lines, shadows','Sound: vibrations, pitch, volume'],tip:'Faster vibrations = higher pitch.'},{name:'Electricity',notes:['Series circuits','Conductors & insulators','More batteries = brighter'],tip:'More bulbs = dimmer (shared voltage).'}]}
];

let ud,sats,section=null,currentSatsSub=null,expandedTopic=null;
const defaultData={squishName:'',sparkles:0,streak:0,lastVisit:null,setupComplete:false,secretsCollected:0,needs:{hunger:70,play:50,rest:80,love:60}};

function load(){
  try{const d=localStorage.getItem(STORAGE_KEY);ud=d?{...defaultData,...JSON.parse(d)}:{...defaultData}}catch(e){ud={...defaultData}}
  try{const s=localStorage.getItem(SATS_KEY);sats=s?JSON.parse(s):{}}catch(e){sats={}}
  render();
}
function save(){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(ud))}catch(e){}}
function saveSats(){try{localStorage.setItem(SATS_KEY,JSON.stringify(sats))}catch(e){}}

let speech='Tap us for a boost! üíï';
let glamQ=null,glamOpts=[],glamResult='';
let puzzle=null,puzzleLetters=[],puzzleAnswer=[],puzzleUsed=[],puzzleResult='';
let storySt='',worrySent=false;
let secret='';
let breathPhase='',breathCount=0,breathing=false;

function addSparkles(n){ud.sparkles+=n;save();render()}
function setSpeech(m){speech=m;render()}

function render(){
  const app=document.getElementById('app');
  if(!ud.setupComplete){app.innerHTML=renderSetup();return}
  if(section==='learning'){app.innerHTML=currentSatsSub?renderSatsSub():renderSatsMain();return}
  if(section){app.innerHTML=renderSection();return}
  app.innerHTML=renderMain();
  const sb=document.getElementById('speechBubble');
  if(sb)sb.textContent=speech;
}

function renderSetup(){
  return '<div class="setup-wrap"><div class="setup-deco">‚ú® üåü ‚ú®</div>'+squishHTML('xl','pink','squish-bounce')+'<div class="setup-deco" style="margin-top:6px">üíñ ü¶ã üíñ</div><div class="setup-title">Squish & Sparkle</div><div class="setup-sub">Give your Squishmallow a name!</div><input class="setup-input" id="nameInput" placeholder="Their name..." maxlength="15"><button class="btn-pink" onclick="completeSetup()">Let\'s Go! ‚ú®</button><div class="setup-deco" style="margin-top:20px">üå∏ ‚ú® üí´ ‚ú® üå∏</div></div>';
}

function completeSetup(){
  const v=document.getElementById('nameInput').value.trim();
  if(!v)return;
  ud.squishName=v;ud.setupComplete=true;ud.lastVisit=new Date().toDateString();
  save();speech="Hi! I'm "+v+"! *excited bounce* üéâ";render();
}

function renderMain(){
  const name=esc(ud.squishName||'Squish');
  const acts=[
    {icon:'üåà',label:'How are you?',key:'mood'},{icon:'‚òÅÔ∏è',label:'Worry Pillow',key:'worry'},
    {icon:'üå∏',label:'Calm Breathing',key:'breathing'},{icon:'üëë',label:'Princess Boost',key:'mentor'},
    {icon:'üíÖ',label:'Glam Maths',key:'glam'},{icon:'üíé',label:'Word Sparkle',key:'word'},
    {icon:'üìñ',label:'Story Studio',key:'story'},{icon:'üåü',label:'Squish Secrets',key:'secrets'},
    {icon:'‚ú®',label:'Daily Glow',key:'quest'},{icon:'üìö',label:'SATs Revision',key:'learning'}
  ];
  const needsData=[
    {key:'hunger',icon:'üç™',label:'Snack'},
    {key:'play',icon:'üéÄ',label:'Play'},
    {key:'rest',icon:'üí§',label:'Rest'},
    {key:'love',icon:'üíï',label:'Love'}
  ];
  return '<div class="sparkle-counter">‚ú® '+ud.sparkles+'</div>'
    +(ud.streak>1?'<div class="streak-badge">üî• '+ud.streak+'</div>':'')
    +'<div class="char-row">'
    +'<div class="char-wrap" onclick="squishTap()"><div class="char-glow">'+squishHTML('lg','pink','squish-bounce')+'</div><div class="char-name">'+name+'</div></div>'
    +'<div class="char-wrap" onclick="mentorTap()"><div class="char-glow-princess"><span class="princess-emoji">üë∏</span></div><div class="char-name">Princess Guardian</div></div>'
    +'</div>'
    +'<div class="bubble"><div class="bubble-trim">‚ú® üíñ ‚ú®</div><div id="speechBubble"></div><div class="bubble-trim">‚ú® üíñ ‚ú®</div></div>'
    +'<div class="hint">üå∏ Your cosy corner, always here for you üå∏</div>'
    +'<div class="needs-card"><div class="needs-title">Take care of '+name+' üíï</div><div class="needs-row">'
    +needsData.map(n=>'<div class="need-item" onclick="careAction(\''+n.key+'\')"><div class="need-icon">'+n.icon+'</div><div class="need-label">'+n.label+'</div><div class="need-bar"><div class="need-fill" style="width:'+ud.needs[n.key]+'%"></div></div></div>').join('')
    +'</div></div>'
    +'<div class="act-grid">'+acts.map(a=>'<div class="act-card" onclick="openSection(\''+a.key+'\')"><div class="act-icon-wrap"><div class="act-icon">'+a.icon+'</div></div><div class="act-label">'+a.label+'</div></div>').join('')+'</div>'
    +'<div class="footer-wrap"><div class="footer-sparkle">üåü ‚ú® üíñ ‚ú® üåü</div><div class="footer">Made with üíï for Sylvie<br>Your data stays on your device</div></div>';
}

const careMsgs={hunger:"Yummy! Thank you for the snack! üç™",play:"Wheee! That was so fun! üéÄ",rest:"*cosy yawn* That was a lovely rest! üí§",love:"I love you so much! *biggest squish hug* üíï"};
function squishTap(){
  speech=pick(squishSayings);addSparkles(1);
  const el=document.querySelector('.squish-bounce');
  if(el){el.classList.remove('squish-pop');void el.offsetWidth;el.classList.add('squish-pop')}
}
function mentorTap(){speech='üëë "'+pick(mentorQuotes)+'"';addSparkles(1)}
function careAction(type){ud.needs[type]=Math.min(100,ud.needs[type]+15);ud.sparkles++;save();speech=careMsgs[type];render()}

function openSection(name){
  section=name;worrySent=false;
  if(name==='glam')loadGlam();
  if(name==='word')loadNewPuzzle();
  if(name==='story')loadNewStory();
  if(name==='secrets')loadNewSecret();
  render();
}
function goBack(){section=null;currentSatsSub=null;expandedTopic=null;render()}
function goBackSats(){currentSatsSub=null;expandedTopic=null;render()}

function renderSection(){
  let c='';
  if(section==='mood') c=renderMood();
  else if(section==='worry') c=renderWorry();
  else if(section==='breathing') c=renderBreathing();
  else if(section==='mentor') c=renderMentor();
  else if(section==='glam') c=renderGlam();
  else if(section==='word') c=renderWord();
  else if(section==='story') c=renderStory();
  else if(section==='secrets') c=renderSecrets();
  else if(section==='quest') c=renderQuest();
  return '<button class="back-btn" onclick="goBack()">‚Üê Back</button>'+c;
}

function renderMood(){
  return secHeader('üåà','How are you feeling?')+'<div class="mood-grid">'+moods.map(m=>'<div class="mood-btn" onclick="selectMood(\''+m.key+'\')"><div class="mood-emoji">'+m.emoji+'</div><div class="mood-lbl">'+m.label+'</div></div>').join('')+'</div>';
}
function selectMood(key){
  const m=moods.find(x=>x.key===key);speech=m.response;addSparkles(1);
  setTimeout(()=>{section=null;render()},1500);
}

function renderWorry(){
  const name=esc(ud.squishName);
  if(worrySent) return '<div style="text-align:center;padding:30px">'+squishHTML('sm','purple')+'<div class="worry-msg">'+name+' is holding your worry safe.<br>It\'s okay now. *soft squeeze* üíï</div><button class="btn-pink" onclick="worrySent=false;render()">Write Another</button></div>';
  return secHeader('‚òÅÔ∏è','Worry Pillow')+'<div class="sub-txt">'+name+' will hold it safe like a soft pillow.</div><textarea class="text-area" id="worryBox" placeholder="Let it all out... I\'m listening..."></textarea><button class="btn-purple" onclick="sendWorry()">üíï Give to '+name+'</button>';
}
function sendWorry(){
  const v=document.getElementById('worryBox').value.trim();
  if(!v){speech="Write down what's worrying you üíï";render();return}
  worrySent=true;speech=ud.squishName+" is holding your worry safe üíï";addSparkles(2);
}

function renderBreathing(){
  return secHeader('üå∏','Calm Breathing')+'<div style="text-align:center;margin:15px 0">'+squishHTML('sm','pink')+'</div><div class="breath-txt">'+(breathPhase||'Ready when you are!')+'</div><div class="breath-dots">'+[0,1,2,3].map(i=>'<div class="dot'+(breathCount>i?' done':'')+'"></div>').join('')+'</div><button class="btn-pink" onclick="startBreathing()" '+(breathing?'disabled':'')+'>'+(breathing?'Breathing...':'Start Breathing üå∏')+'</button>';
}
function startBreathing(){if(breathing)return;breathing=true;breathCount=0;render();doBreath(0)}
function doBreath(c){
  if(c>=4){breathPhase='Well done! üå∏';breathing=false;speech="Beautiful breathing, gorgeous! ‚ú®";addSparkles(3);return}
  breathPhase='Breathe in... üå∏';render();
  setTimeout(()=>{breathPhase='Hold... ‚ú®';render()},3000);
  setTimeout(()=>{breathPhase='Breathe out... üí®';render()},5000);
  setTimeout(()=>{breathCount=c+1;doBreath(c+1)},8000);
}

function renderMentor(){
  return secHeader('üëë','Princess Boost')+'<div class="card"><div style="font-size:40px;text-align:center;margin-bottom:8px">üë∏</div><div class="mentor-qt">"'+esc(pick(mentorQuotes))+'"</div></div><button class="btn-pink" onclick="speech=\'üëë Your Princess Guardian believes in you!\';addSparkles(1);section=\'mentor\';render()">Another Boost üëë</button>';
}

function loadGlam(){const q=pick(glamQuestions);glamQ=q;glamOpts=shuffle(q.options);glamResult=''}
function renderGlam(){
  if(!glamQ)return'';
  return secHeader('üíÖ','Glam Maths')+'<div class="card"><div class="glam-q">'+esc(glamQ.q)+'</div><div class="glam-grid">'+glamOpts.map(o=>'<div class="glam-opt" onclick="checkGlam('+o+')">'+o+'</div>').join('')+'</div>'+(glamResult?'<div class="result-txt">'+glamResult+'</div>':'')+'</div><button class="btn-pink" onclick="loadGlam();render()">Next Question üíÖ</button>';
}
function checkGlam(ans){
  if(glamResult)return;
  if(ans===glamQ.a){glamResult='üéâ Correct! You\'re a glam genius!';addSparkles(2)}
  else{glamResult='The answer was '+glamQ.a+'. Great try! üí™';render()}
}

function loadNewPuzzle(){const p=pick(puzzleWords);puzzle=p;puzzleLetters=shuffle(p.word.split(''));puzzleAnswer=[];puzzleUsed=[];puzzleResult=''}
function renderWord(){
  if(!puzzle)return'';
  return secHeader('üíé','Word Sparkle')+'<div class="card"><div class="hint-txt">Hint: '+esc(puzzle.hint)+'</div><div class="answer-row">'+puzzle.word.split('').map((_,i)=>'<div class="ans-slot">'+(puzzleAnswer[i]||'')+'</div>').join('')+'</div><div class="letter-row">'+puzzleLetters.map((l,i)=>'<div class="letter-tile'+(puzzleUsed.includes(i)?' used':'')+'" onclick="tapLetter(\''+l+'\','+i+')">'+l+'</div>').join('')+'</div>'+(puzzleResult?'<div class="result-txt">'+puzzleResult+'</div>':'')+'</div><button class="btn-purple" onclick="loadNewPuzzle();render()">New Word üíé</button>';
}
function tapLetter(l,i){
  if(puzzleUsed.includes(i))return;
  puzzleAnswer.push(l);puzzleUsed.push(i);
  if(puzzleAnswer.length===puzzle.word.length){
    if(puzzleAnswer.join('')===puzzle.word){puzzleResult='üéâ Sparkling! You got it!';addSparkles(2);return}
    else puzzleResult='The word was '+puzzle.word+'. Try again! üí™';
  }
  render();
}

function loadNewStory(){storySt=pick(storyStarters).replace(/SQUISH/g,ud.squishName||'Squish')}
function renderStory(){
  return secHeader('üìñ','Story Studio')+'<div class="card"><div class="story-start">'+esc(storySt)+'</div><textarea class="text-area" id="storyBox" placeholder="Continue the story..."></textarea></div><div class="btn-row"><button class="btn-pink" onclick="saveStory()">Save ‚ú®</button><button class="btn-purple" onclick="loadNewStory();render()">New Story</button></div>';
}
function saveStory(){
  const v=document.getElementById('storyBox').value.trim();
  if(!v){speech="Write something first! üìñ";render();return}
  speech="Amazing story! You're so creative! ‚ú®";loadNewStory();addSparkles(3);
}

function loadNewSecret(){secret=pick(squishSecrets);ud.secretsCollected=(ud.secretsCollected||0)+1;ud.sparkles++;save()}
function renderSecrets(){
  return secHeader('üåü','Squish Secrets')+'<div class="secret-count">Secrets collected: '+(ud.secretsCollected||0)+'</div><div class="card"><div class="secret-txt">'+secret+'</div></div><button class="btn-pink" onclick="loadNewSecret();render()">Next Secret üåü</button>';
}

function renderQuest(){
  return secHeader('‚ú®','Daily Glow')+'<div class="card"><div class="quest-txt">Today\'s sparkle mission!</div><div class="glam-q">Answer 3 Glam Maths questions! üíÖ</div></div><button class="btn-pink" onclick="speech=\'You did it! You\\\'re glowing! ‚ú®üéâ\';addSparkles(5)">I did it! ‚ú®</button>';
}

// SATs
function satsK(subId,idx){return subId+'_'+idx}
function isSatsDone(subId,idx){return !!(sats[satsK(subId,idx)]?.done)}
function getSatsConf(subId,idx){return sats[satsK(subId,idx)]?.confidence||null}
function toggleSats(subId,idx){const k=satsK(subId,idx);sats[k]={...sats[k],done:!(sats[k]?.done)};saveSats();if(sats[k].done)addSparkles(2);else render()}
function setSatsConfidence(subId,idx,level){const k=satsK(subId,idx);sats[k]={...sats[k],confidence:level};saveSats();render()}
function satsPct(sub){let d=0;sub.topics.forEach((_,i)=>{if(isSatsDone(sub.id,i))d++});return Math.round((d/sub.topics.length)*100)}
function satsGlobalPct(){let t=0,d=0;SATS_SUBJECTS.forEach(s=>s.topics.forEach((_,i)=>{t++;if(isSatsDone(s.id,i))d++}));return t?Math.round((d/t)*100):0}

function renderSatsMain(){
  const gp=satsGlobalPct();
  return '<button class="back-btn" onclick="goBack()">‚Üê Back</button>'+secHeader('üìö','SATs Revision')+'<div class="prog-outer"><div class="prog-fill" style="width:'+gp+'%"></div></div><div class="prog-lbl">'+gp+'% complete</div><div class="sats-grid">'+SATS_SUBJECTS.map(sub=>{const p=satsPct(sub);return'<div class="sats-card" onclick="currentSatsSub=SATS_SUBJECTS.find(s=>s.id===\''+sub.id+'\');render()"><div class="sats-icon">'+sub.icon+'</div><div class="sats-nm">'+sub.name+'</div><div class="sats-cnt">'+sub.topics.length+' topics</div><div class="sats-bar-o"><div class="sats-bar-f" style="width:'+p+'%;background:'+sub.color+'"></div></div><div class="sats-pct">'+p+'%</div></div>'}).join('')+'</div>';
}

function renderSatsSub(){
  const sub=currentSatsSub;
  return '<button class="back-btn" onclick="goBackSats()">‚Üê Back</button>'+secHeader(sub.icon,sub.name)
  +sub.topics.map((topic,i)=>{
    const done=isSatsDone(sub.id,i),conf=getSatsConf(sub.id,i),exp=expandedTopic===i;
    const confs=[{l:'red',t:'üî¥ Not sure',bg:'#FFE0E0',bc:'#FF6B6B'},{l:'amber',t:'üü° Getting there',bg:'#FFF3D0',bc:'#FFB347'},{l:'green',t:'üü¢ Got it',bg:'#D5F5E3',bc:'#58D68D'}];
    return'<div class="topic-card"><div class="topic-row"><div class="chk'+(done?' done':'')+'" onclick="toggleSats(\''+sub.id+'\','+i+')">'+(done?'<span class="chk-mark">‚úì</span>':'')+'</div><div class="topic-nm'+(done?' done-txt':'')+'">'+esc(topic.name)+'</div><div class="notes-btn" onclick="expandedTopic='+(exp?'null':i)+';render()">'+(exp?'hide ‚ñ¥':'notes ‚ñæ')+'</div></div>'
    +(exp?'<div class="notes-panel">'+topic.notes.map(n=>'<div class="note-txt">‚Ä¢ '+esc(n)+'</div>').join('')+(topic.tip?'<div class="tip-box"><div class="tip-txt">üí° '+esc(topic.tip)+'</div></div>':'')+'<div class="conf-row">'+confs.map(c=>'<div class="conf-btn" style="'+(conf===c.l?'background:'+c.bg+';border-color:'+c.bc:'')+'" onclick="setSatsConfidence(\''+sub.id+'\','+i+',\''+c.l+'\')">'+c.t+'</div>').join('')+'</div></div>':'')
    +'</div>'}).join('');
}

load();
</script>
</body>
</html>
