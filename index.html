<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>Squish & Sparkle</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#FFE4EC;min-height:100vh;overflow-x:hidden}
.app{max-width:420px;margin:0 auto;padding:16px;padding-bottom:40px;position:relative}
.sparkle-counter{position:fixed;top:16px;right:16px;background:#FF69B4;border-radius:20px;padding:6px 14px;color:#fff;font-weight:bold;font-size:15px;z-index:10}
.streak-badge{position:fixed;top:16px;left:16px;background:#FFD700;border-radius:20px;padding:6px 12px;color:#5D4E37;font-weight:bold;font-size:14px;z-index:10}
.char-row{display:flex;justify-content:center;gap:30px;margin-top:50px;margin-bottom:10px}
.char-wrap{text-align:center;cursor:pointer;user-select:none}
.char-emoji{font-size:70px;display:block;animation:bounce 3s ease-in-out infinite}
.mentor-emoji{font-size:50px;display:block}
.char-name{font-size:13px;font-weight:bold;color:#8B4A6B;margin-top:4px}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.bubble{background:#fff;border-radius:18px;padding:14px;margin:12px 20px 0;border:2px solid #FFB6C1;box-shadow:0 2px 8px rgba(0,0,0,.08);text-align:center;font-size:15px;color:#5D4E37;line-height:22px}
.hint{text-align:center;color:#B8A0C8;font-size:13px;margin:8px 0 12px}
.needs-card{background:#fff;border-radius:16px;padding:14px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.needs-title{font-size:14px;color:#8B4A6B;text-align:center;margin-bottom:10px}
.needs-row{display:flex;justify-content:space-around}
.need-item{text-align:center;padding:6px;cursor:pointer}
.need-icon{font-size:22px}
.need-label{font-size:11px;color:#888;margin-top:2px}
.need-bar{width:36px;height:5px;background:#eee;border-radius:3px;margin:4px auto 0;overflow:hidden}
.need-fill{height:100%;background:#FF69B4;border-radius:3px;transition:width .3s}
.act-grid{display:flex;flex-wrap:wrap;justify-content:space-between;margin-top:16px}
.act-card{width:48%;background:#fff;border-radius:18px;padding:18px;text-align:center;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.07);cursor:pointer;transition:transform .15s}
.act-card:active{transform:scale(.95)}
.act-icon{font-size:34px;margin-bottom:6px}
.act-label{font-size:13px;font-weight:600;color:#8B4A6B}
.footer{text-align:center;color:#8B4A6B;opacity:.6;font-size:12px;margin-top:20px;line-height:18px}
.btn-pink{background:#FF69B4;border:none;border-radius:14px;padding:14px 24px;color:#fff;font-weight:bold;font-size:15px;cursor:pointer;margin-top:14px;width:100%;transition:transform .15s}
.btn-pink:active{transform:scale(.95)}
.btn-purple{background:#9B59B6;border:none;border-radius:14px;padding:14px 24px;color:#fff;font-weight:bold;font-size:15px;cursor:pointer;margin-top:14px;width:100%;transition:transform .15s}
.btn-purple:active{transform:scale(.95)}
.back-btn{margin-bottom:10px;padding:8px 14px;background:#fff;border:none;border-radius:12px;color:#8B4A6B;font-weight:600;font-size:14px;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.sec-title{font-size:20px;font-weight:bold;color:#8B4A6B;text-align:center;margin-bottom:16px}
.sub-txt{text-align:center;color:#8B4A6B;margin-bottom:12px;font-size:14px}
.card{background:#fff;border-radius:16px;padding:18px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
.setup-wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:80vh;padding:30px}
.setup-title{font-size:28px;font-weight:bold;color:#8B4A6B;margin-top:20px}
.setup-sub{font-size:15px;color:#B07A9E;margin-top:8px;margin-bottom:25px}
.setup-input{width:80%;padding:14px;border:3px solid #FFB6C1;border-radius:15px;font-size:16px;text-align:center;background:#fff;color:#8B4A6B;outline:none}
.setup-input::placeholder{color:#cba}
.mood-grid{display:flex;flex-wrap:wrap;justify-content:center;gap:10px}
.mood-btn{background:#fff;border:2px solid #FFB6C1;border-radius:14px;padding:12px;text-align:center;min-width:70px;cursor:pointer;transition:transform .15s}
.mood-btn:active{transform:scale(.9)}
.mood-emoji{font-size:28px}
.mood-lbl{font-size:11px;color:#8B4A6B;margin-top:4px}
.text-area{width:100%;border:2px solid #C9A0DC;border-radius:14px;padding:14px;font-size:15px;background:#fff;min-height:90px;resize:vertical;font-family:inherit;outline:none;color:#5D4E37}
.text-area::placeholder{color:#B8A0C8}
.worry-msg{font-size:16px;color:#8B4A6B;text-align:center;margin-top:14px;line-height:24px}
.breath-txt{font-size:22px;font-weight:bold;color:#5B7DB1;text-align:center;min-height:34px}
.breath-dots{display:flex;justify-content:center;gap:10px;margin:16px 0}
.dot{width:14px;height:14px;border-radius:7px;background:#ccc;transition:all .3s}
.dot.done{background:#5B7DB1;transform:scale(1.2)}
.mentor-qt{font-size:16px;color:#8B4A6B;font-style:italic;line-height:24px;text-align:center}
.glam-q{font-size:15px;color:#5D4E37;text-align:center;margin-bottom:14px;line-height:22px}
.glam-grid{display:flex;flex-wrap:wrap;gap:8px}
.glam-opt{width:47%;padding:14px;background:#f8f8f8;border:2px solid #eee;border-radius:12px;text-align:center;cursor:pointer;font-size:16px;font-weight:600;color:#5D4E37;transition:transform .15s}
.glam-opt:active{transform:scale(.95)}
.result-txt{text-align:center;font-size:15px;font-weight:bold;color:#8B4A6B;margin-top:12px}
.hint-txt{text-align:center;color:#666;font-style:italic;margin-bottom:12px}
.answer-row{display:flex;justify-content:center;gap:4px;margin-bottom:14px}
.ans-slot{width:32px;height:38px;background:#f0f0f0;border:2px dashed #ccc;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:bold}
.letter-row{display:flex;flex-wrap:wrap;justify-content:center;gap:6px}
.letter-tile{width:38px;height:38px;background:#fff;border:2px solid #9B59B6;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:bold;color:#9B59B6;cursor:pointer;transition:transform .15s}
.letter-tile:active{transform:scale(.9)}
.letter-tile.used{opacity:.25;pointer-events:none}
.story-start{font-size:14px;color:#5D4E37;line-height:22px;font-style:italic;margin-bottom:12px}
.secret-count{text-align:center;color:#B8860B;margin-bottom:10px;font-size:13px}
.secret-txt{font-size:15px;color:#5D4E37;line-height:23px;text-align:center}
.quest-txt{text-align:center;color:#8B4A6B;margin-bottom:10px;font-size:14px}
.btn-row{display:flex;gap:10px}
.btn-row .btn-pink,.btn-row .btn-purple{flex:1}
.prog-outer{height:12px;background:rgba(255,105,180,.15);border-radius:8px;margin:0 30px;overflow:hidden}
.prog-fill{height:100%;background:#FF69B4;border-radius:8px;transition:width .3s}
.prog-lbl{text-align:center;font-size:12px;color:#8B4A6B;margin:4px 0 14px}
.sats-grid{display:flex;flex-wrap:wrap;justify-content:space-between}
.sats-card{width:48%;background:#fff;border-radius:16px;padding:14px;margin-bottom:10px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.06);cursor:pointer;transition:transform .15s}
.sats-card:active{transform:scale(.95)}
.sats-icon{font-size:30px}
.sats-nm{font-size:13px;font-weight:700;color:#8B4A6B;margin-top:4px;white-space:pre-line}
.sats-cnt{font-size:10px;color:#999;margin:2px 0 6px}
.sats-bar-o{height:5px;width:100%;background:rgba(255,105,180,.15);border-radius:3px;overflow:hidden}
.sats-bar-f{height:100%;border-radius:3px;transition:width .3s}
.sats-pct{font-size:10px;color:#8B4A6B;margin-top:2px}
.topic-card{background:#fff;border-radius:16px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.06);overflow:hidden}
.topic-row{display:flex;align-items:center;padding:12px;gap:8px}
.chk{width:22px;height:22px;border-radius:6px;border:2px solid #ddd;background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0}
.chk.done{background:#FF69B4;border-color:#FF69B4}
.chk-mark{color:#fff;font-size:13px;font-weight:bold}
.topic-nm{flex:1;font-size:14px;font-weight:600;color:#8B4A6B}
.topic-nm.done-txt{text-decoration:line-through;opacity:.4}
.notes-btn{background:#FFF0F5;border-radius:8px;padding:3px 8px;border:1px solid #FFB6C1;cursor:pointer;font-size:11px;color:#8B4A6B}
.notes-panel{padding:0 14px 12px 42px}
.note-txt{font-size:13px;color:#5D4E37;line-height:20px;margin-bottom:2px}
.tip-box{background:rgba(255,105,180,.08);border-left:3px solid #FF69B4;border-radius:8px;padding:10px;margin-top:6px}
.tip-txt{font-size:13px;color:#8B4A6B;line-height:19px}
.conf-row{display:flex;flex-wrap:wrap;gap:5px;margin-top:8px}
.conf-btn{padding:4px 7px;border-radius:7px;border:2px solid #eee;background:#fff;cursor:pointer;font-size:10px}
</style>
</head>
<body>
<div class="app" id="app"></div>
<script>
const STORAGE_KEY='squish-sparkle-app',SATS_KEY='sylvie-sats';
const pick=a=>a[Math.floor(Math.random()*a.length)];
const shuffle=a=>[...a].sort(()=>Math.random()-.5);
const esc=s=>s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');

const mentorQuotes=["You are absolutely gorgeous inside and out, and don't you ever forget it!","Confidence looks beautiful on you, babe!","You don't need anyone's approval to be amazing - you already are!","Every single person has their own kind of sparkle, and yours is stunning!","Bad days don't make you a bad person. They make you human, and that's beautiful!","You're not too much. You're exactly enough. The right people will see that!","Your vibe attracts your tribe - keep shining, gorgeous!","It's okay to not have it all figured out. Nobody does, trust me!","Self-care isn't selfish, it's necessary. Look after yourself, queen!","You are worthy of love and kindness - especially from yourself!","Comparison is the thief of joy. Your journey is YOUR journey!","Being yourself is your superpower. Use it!","You're stronger than you know, braver than you believe!","Your feelings are valid. Every. Single. One.","Progress, not perfection. You're doing amazing!","The world needs what YOU have to offer. Don't hide your light!","Dream big, sparkle more, shine bright!"];

const squishSayings=["*happy squish bounce* I love you! \u{1F495}","You're the best! *snuggle*","*soft squeeze* You make me so happy!","I'm always here for cuddles! \u{1F9F8}","*bounces excitedly* Yay, it's you!","You're my favourite person! \u{1F495}","*cosy snuggle* Everything's gonna be okay!"];

const glamQuestions=[{q:"You have 12 lipsticks and give 4 to your friend. How many left?",a:8,options:[6,8,10,7]},{q:"Each palette has 6 colours. You have 3 palettes. How many colours?",a:18,options:[15,18,21,12]},{q:"Nail polish costs \u00A35. How much for 4 bottles?",a:20,options:[15,20,25,18]},{q:"You need 2 cotton pads per eye. How many for 5 makeovers?",a:20,options:[15,20,25,10]},{q:"Your collection has 15 items. Buy 7 more. How many now?",a:22,options:[20,22,25,21]},{q:"A face mask takes 15 mins. How long for 3 masks?",a:45,options:[30,45,60,40]},{q:"24 hair clips shared between 4 friends. How many each?",a:6,options:[4,6,8,5]},{q:"Lip gloss \u00A33 and mascara \u00A37. How much for both?",a:10,options:[9,10,11,8]},{q:"10 nails with 2 coats each. Total coats?",a:20,options:[15,20,25,12]},{q:"30 Squishmallows, display half. How many on display?",a:15,options:[10,15,20,12]}];

const puzzleWords=[{word:"GLITTER",hint:"Sparkly stuff for crafts"},{word:"SPARKLE",hint:"To shine brightly"},{word:"SQUISH",hint:"What your soft friend does"},{word:"FLUFFY",hint:"Soft and cuddly"},{word:"CUDDLE",hint:"A warm, cosy hug"},{word:"SHIMMER",hint:"A soft, pretty glow"},{word:"GLOW",hint:"To shine softly"},{word:"COSY",hint:"Warm and comfortable"},{word:"SHINE",hint:"To be bright and glossy"},{word:"BEAUTY",hint:"Looking and feeling lovely"},{word:"CHARM",hint:"Something lovely and delightful"},{word:"SNUGGLE",hint:"To cuddle up close"}];

const storyStarters=["SQUISH was having a cosy day when a tiny glittering envelope appeared on the windowsill...","At the Squishmallow sleepover, SQUISH noticed something magical in the garden...","SQUISH found a mysterious pink door that had never been there before. Behind it was...","One sparkly morning, SQUISH discovered they could grant one wish. They decided to...","SQUISH and their best friend found a map to the legendary Glitter Grotto...","A new Squishmallow arrived in town with a secret. SQUISH was determined to help...","SQUISH woke up to find everything had turned pink and sparkly overnight...","The glitter jar spilled and something magical started to grow...","A shooting star landed in SQUISH's garden, and out stepped..."];

const squishSecrets=["Squishmallows were first created in 2017 and became super popular because everyone loves their squishy softness! \u{1F9F8}","There are over 1,000 different Squishmallow characters! Each one has their own name and personality! \u{1F382}","The rarest Squishmallows can be worth hundreds of pounds to collectors! \u{1F48E}","Smiling releases chemicals that make you feel happier - even if you're faking it at first! \u{1F60A}","Your brain can't tell the difference between a real hug and hugging a soft toy - both release feel-good hormones! \u{1F917}","Colours affect your mood! Pink is calming, yellow is energising, blue helps you focus! \u{1F308}","Being kind to others actually makes YOU feel happier too - kindness is a two-way sparkle! \u{2728}","Everyone feels worried sometimes - it's your brain trying to protect you! \u{1F9E0}","Getting enough sleep helps your brain recharge and even helps your skin! \u{1F4A4}"];

const moods=[{key:'happy',emoji:'\u{1F60A}',label:'Happy',response:'Yay! That makes me so happy too! \u{1F389}'},{key:'calm',emoji:'\u{1F60C}',label:'Calm',response:"That's so peaceful \u{1F338}"},{key:'worried',emoji:'\u{1F61F}',label:'Worried',response:"*gives you a big squishy hug* I'm here \u{1F495}"},{key:'sad',emoji:'\u{1F622}',label:'Sad',response:"*snuggles close* It's okay to feel this way \u{1F495}"},{key:'angry',emoji:'\u{1F620}',label:'Angry',response:"Those feelings are totally valid. I'm here \u{1F495}"},{key:'tired',emoji:'\u{1F634}',label:'Tired',response:'Rest is so important. Calm breathing? \u{1F4A4}'},{key:'anxious',emoji:'\u{1F630}',label:'Anxious',response:"*soft squeeze* Moment by moment \u{1F308}"},{key:'excited',emoji:'\u{1F929}',label:'Excited',response:'Ooh exciting! Tell me everything! \u{2728}'}];

const SATS_SUBJECTS=[
{id:'ma',name:'Maths Arithmetic',icon:'\u{2795}',color:'#FF69B4',topics:[{name:'Place Value',notes:['Numbers up to 10,000,000','Value of each digit','Rounding','Negative numbers'],tip:'Place value chart: M, HTh, TTh, Th, H, T, O.'},{name:'Addition & Subtraction',notes:['Column addition with carrying','Column subtraction with exchanging','Decimals','Inverse operations'],tip:'Line up decimal points!'},{name:'Multiplication',notes:['Times tables to 12x12','Long multiplication','Multiplying decimals','x10, x100, x1000'],tip:'Zero placeholder on second row!'},{name:'Division',notes:['Bus stop method','Long division','Remainders as fractions/decimals','div 10, div 100, div 1000'],tip:'Divide, multiply, subtract, bring down!'},{name:'Fractions',notes:['Equivalent fractions','Simplify','Add & subtract','Multiply & divide'],tip:'Common denominator = LCM.'},{name:'Decimals & %',notes:['Fractions to decimals','Decimals to %','1/2=50%, 1/4=25%, 1/10=10%','% of amounts'],tip:'10%=div 10, 5%=half of 10%.'},{name:'BODMAS',notes:['Brackets','Orders','Division & Multiplication','Addition & Subtraction'],tip:'Brackets first!'}]},
{id:'mr',name:'Maths Reasoning',icon:'\u{1F9E9}',color:'#C9A0DC',topics:[{name:'Ratio & Proportion',notes:['Share in a ratio','Scale factors','One part method'],tip:'Find one part first.'},{name:'Algebra',notes:['Missing numbers','Simple formulae','Sequences','e.g. 2a+3=11'],tip:'Use inverse operations.'},{name:'Measurement',notes:['Convert units','Perimeter & area','Compound shapes','Volume of cuboids'],tip:'Split compound shapes into rectangles.'},{name:'Shapes & Angles',notes:['2D properties','Triangle=180 deg','Straight line=180 deg','Protractor use'],tip:'Check inner/outer scale.'},{name:'Statistics',notes:['Charts & graphs','Calculate mean','Data problems'],tip:'Pie chart = 360 deg.'},{name:'Word Problems',notes:['Read twice','Underline key info','Show working','Check answer'],tip:'RUCSAC method.'}]},
{id:'er',name:'English Reading',icon:'\u{1F4D6}',color:'#5B7DB1',topics:[{name:'Retrieval',notes:['Find & copy','Info directly stated','Scan for key words'],tip:'Underline key words first.'},{name:'Inference',notes:['What is suggested','Evidence from text','PEE method'],tip:'Point, Evidence, Explain.'},{name:'Vocabulary',notes:['Meaning from context','Synonyms that fit'],tip:'Swap the word - still make sense?'},{name:'Summarising',notes:['Main idea','Events in order','Key points only'],tip:'One sentence per paragraph.'},{name:'Prediction',notes:['Clues from text','Based on evidence'],tip:'"I think... because the text says..."'},{name:"Author's Language",notes:['Why that word?','Effect on reader','Techniques'],tip:'"The author uses [X] to make the reader feel..."'}]},
{id:'eg',name:'Grammar & Spelling',icon:'\u{270F}\u{FE0F}',color:'#FFB347',topics:[{name:'Word Classes',notes:['Nouns, verbs, adjectives','Adverbs, pronouns','Prepositions, conjunctions'],tip:"Remove it - what's missing?"},{name:'Sentence Types',notes:['Statement, question','Command, exclamation'],tip:'Exclamation = What/How + verb + !'},{name:'Clauses',notes:['Main clause','Subordinate clause','Relative clause'],tip:'Alone = main. Needs help = subordinate.'},{name:'Punctuation',notes:['Commas','Apostrophes','Speech marks','Colons & semi-colons'],tip:"it's = it is. its = belonging to it."},{name:'Tenses',notes:['Simple past & present','Progressive','Perfect'],tip:'Perfect = have/has + past participle.'},{name:'Active & Passive',notes:['Active: cat chased mouse','Passive: mouse was chased'],tip:'"By zombies" test = passive!'},{name:'Spelling',notes:['Silent letters','Homophones','Prefixes & suffixes'],tip:'Look, cover, write, check x3.'}]},
{id:'sc',name:'Science',icon:'\u{1F52C}',color:'#7EC8A0',topics:[{name:'Living Things',notes:['Classification','Vertebrates & invertebrates','Life cycles'],tip:'Mammals: warm-blooded, hair, milk.'},{name:'Animals & Humans',notes:['Circulatory system','Diet & health','Digestive system'],tip:'Heart has 4 chambers.'},{name:'Evolution',notes:['Inheritance','Adaptation','Natural selection','Fossils'],tip:'Adaptation + time = evolution.'},{name:'Materials',notes:['Properties','Dissolving','Reversible vs irreversible'],tip:'Get it back? Reversible.'},{name:'Earth & Space',notes:['Day/night','Seasons','Planets in order'],tip:'My Very Excited Mum Just Served Us Nachos.'},{name:'Forces',notes:['Gravity','Friction','Air resistance','Levers & pulleys'],tip:'Parachute = more air resistance.'},{name:'Light & Sound',notes:['Light: straight lines, shadows','Sound: vibrations, pitch, volume'],tip:'Faster vibrations = higher pitch.'},{name:'Electricity',notes:['Series circuits','Conductors & insulators','More batteries = brighter'],tip:'More bulbs = dimmer (shared voltage).'}]}
];

let ud,sats,section=null,currentSatsSub=null,expandedTopic=null;
const defaultData={squishName:'',sparkles:0,streak:0,lastVisit:null,setupComplete:false,secretsCollected:0,needs:{hunger:70,play:50,rest:80,love:60}};

function load(){
  try{const d=localStorage.getItem(STORAGE_KEY);ud=d?{...defaultData,...JSON.parse(d)}:{...defaultData}}catch(e){ud={...defaultData}}
  try{const s=localStorage.getItem(SATS_KEY);sats=s?JSON.parse(s):{}}catch(e){sats={}}
  render();
}
function save(){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(ud))}catch(e){}}
function saveSats(){try{localStorage.setItem(SATS_KEY,JSON.stringify(sats))}catch(e){}}

let speech='Tap us for a boost! \u{1F495}';
let glamQ=null,glamOpts=[],glamResult='';
let puzzle=null,puzzleLetters=[],puzzleAnswer=[],puzzleUsed=[],puzzleResult='';
let storySt='',worrySent=false;
let secret='';
let breathPhase='',breathCount=0,breathing=false;

function addSparkles(n){ud.sparkles+=n;save();render()}
function setSpeech(m){speech=m;render()}

function render(){
  const app=document.getElementById('app');
  if(!ud.setupComplete){app.innerHTML=renderSetup();return}
  if(section==='learning'){app.innerHTML=currentSatsSub?renderSatsSub():renderSatsMain();return}
  if(section){app.innerHTML=renderSection();return}
  app.innerHTML=renderMain();
  const sb=document.getElementById('speechBubble');
  if(sb)sb.textContent=speech;
}

function renderSetup(){
  return '<div class="setup-wrap"><div style="font-size:80px">\u{1F9F8}</div><div class="setup-title">Squish & Sparkle</div><div class="setup-sub">Give your Squishmallow a name!</div><input class="setup-input" id="nameInput" placeholder="Their name..." maxlength="15"><button class="btn-pink" onclick="completeSetup()">Let\'s Go! \u{2728}</button></div>';
}

function completeSetup(){
  const v=document.getElementById('nameInput').value.trim();
  if(!v)return;
  ud.squishName=v;ud.setupComplete=true;ud.lastVisit=new Date().toDateString();
  save();speech="Hi! I'm "+v+"! *excited bounce* \u{1F389}";render();
}

function renderMain(){
  const name=esc(ud.squishName||'Squish');
  const acts=[
    {icon:'\u{1F308}',label:'How are you?',key:'mood'},{icon:'\u{2601}\u{FE0F}',label:'Worry Pillow',key:'worry'},
    {icon:'\u{1F338}',label:'Calm Breathing',key:'breathing'},{icon:'\u{1F484}',label:'Glam Boost',key:'mentor'},
    {icon:'\u{1F485}',label:'Glam Maths',key:'glam'},{icon:'\u{1F48E}',label:'Word Sparkle',key:'word'},
    {icon:'\u{1F4D6}',label:'Story Studio',key:'story'},{icon:'\u{1F31F}',label:'Squish Secrets',key:'secrets'},
    {icon:'\u{2728}',label:'Daily Glow',key:'quest'},{icon:'\u{1F4DA}',label:'SATs Revision',key:'learning'}
  ];
  const needsData=[
    {key:'hunger',icon:'\u{1F36A}',label:'Snack'},
    {key:'play',icon:'\u{1F380}',label:'Play'},
    {key:'rest',icon:'\u{1F4A4}',label:'Rest'},
    {key:'love',icon:'\u{1F495}',label:'Love'}
  ];
  return '<div class="sparkle-counter">\u{2728} '+ud.sparkles+'</div>'
    +(ud.streak>1?'<div class="streak-badge">\u{1F525} '+ud.streak+'</div>':'')
    +'<div class="char-row">'
    +'<div class="char-wrap" onclick="squishTap()"><span class="char-emoji">\u{1F9F8}</span><div class="char-name">'+name+'</div></div>'
    +'<div class="char-wrap" onclick="mentorTap()"><span class="mentor-emoji">\u{1F484}</span><div class="char-name">Glam Mentor</div></div>'
    +'</div>'
    +'<div class="bubble" id="speechBubble"></div>'
    +'<div class="hint">Your cosy corner, always here for you</div>'
    +'<div class="needs-card"><div class="needs-title">Take care of '+name+' \u{1F495}</div><div class="needs-row">'
    +needsData.map(n=>'<div class="need-item" onclick="careAction(\''+n.key+'\')"><div class="need-icon">'+n.icon+'</div><div class="need-label">'+n.label+'</div><div class="need-bar"><div class="need-fill" style="width:'+ud.needs[n.key]+'%"></div></div></div>').join('')
    +'</div></div>'
    +'<div class="act-grid">'+acts.map(a=>'<div class="act-card" onclick="openSection(\''+a.key+'\')"><div class="act-icon">'+a.icon+'</div><div class="act-label">'+a.label+'</div></div>').join('')+'</div>'
    +'<div class="footer">Made with \u{1F495} for you<br>Your data stays on your device</div>';
}

const careMsgs={hunger:"Yummy! Thank you for the snack! \u{1F36A}",play:"Wheee! That was so fun! \u{1F380}",rest:"*cosy yawn* That was a lovely rest! \u{1F4A4}",love:"I love you so much! *biggest squish hug* \u{1F495}"};
function squishTap(){speech=pick(squishSayings);addSparkles(1)}
function mentorTap(){speech='\u{1F484} "'+pick(mentorQuotes)+'"';addSparkles(1)}
function careAction(type){ud.needs[type]=Math.min(100,ud.needs[type]+15);ud.sparkles++;save();speech=careMsgs[type];render()}

function openSection(name){
  section=name;worrySent=false;
  if(name==='glam')loadGlam();
  if(name==='word')loadNewPuzzle();
  if(name==='story')loadNewStory();
  if(name==='secrets')loadNewSecret();
  render();
}
function goBack(){section=null;currentSatsSub=null;expandedTopic=null;render()}
function goBackSats(){currentSatsSub=null;expandedTopic=null;render()}

function renderSection(){
  let c='';
  if(section==='mood') c=renderMood();
  else if(section==='worry') c=renderWorry();
  else if(section==='breathing') c=renderBreathing();
  else if(section==='mentor') c=renderMentor();
  else if(section==='glam') c=renderGlam();
  else if(section==='word') c=renderWord();
  else if(section==='story') c=renderStory();
  else if(section==='secrets') c=renderSecrets();
  else if(section==='quest') c=renderQuest();
  return '<button class="back-btn" onclick="goBack()">\u{2190} Back</button>'+c;
}

function renderMood(){
  return '<div class="sec-title">How are you feeling?</div><div class="mood-grid">'+moods.map(m=>'<div class="mood-btn" onclick="selectMood(\''+m.key+'\')"><div class="mood-emoji">'+m.emoji+'</div><div class="mood-lbl">'+m.label+'</div></div>').join('')+'</div>';
}
function selectMood(key){
  const m=moods.find(x=>x.key===key);speech=m.response;addSparkles(1);
  setTimeout(()=>{section=null;render()},1500);
}

function renderWorry(){
  const name=esc(ud.squishName);
  if(worrySent) return '<div style="text-align:center;padding:30px"><div style="font-size:50px">\u{1F9F8}</div><div class="worry-msg">'+name+' is holding your worry safe.<br>It\'s okay now. *soft squeeze* \u{1F495}</div><button class="btn-pink" onclick="worrySent=false;render()">Write Another</button></div>';
  return '<div class="sec-title">\u{2601}\u{FE0F} Worry Pillow</div><div class="sub-txt">'+name+' will hold it safe like a soft pillow.</div><textarea class="text-area" id="worryBox" placeholder="Let it all out... I\'m listening..."></textarea><button class="btn-purple" onclick="sendWorry()">\u{1F9F8} Give to '+name+'</button>';
}
function sendWorry(){
  const v=document.getElementById('worryBox').value.trim();
  if(!v){speech="Write down what's worrying you \u{1F495}";render();return}
  worrySent=true;speech=ud.squishName+" is holding your worry safe \u{1F495}";addSparkles(2);
}

function renderBreathing(){
  return '<div class="sec-title">\u{1F338} Calm Breathing</div><div style="font-size:60px;text-align:center;margin:15px 0">\u{1F484}</div><div class="breath-txt">'+(breathPhase||'Ready when you are!')+'</div><div class="breath-dots">'+[0,1,2,3].map(i=>'<div class="dot'+(breathCount>i?' done':'')+'"></div>').join('')+'</div><button class="btn-pink" onclick="startBreathing()" '+(breathing?'disabled':'')+'>'+( breathing?'Breathing...':'Start Breathing \u{1F338}')+'</button>';
}
function startBreathing(){if(breathing)return;breathing=true;breathCount=0;render();doBreath(0)}
function doBreath(c){
  if(c>=4){breathPhase='Well done! \u{1F338}';breathing=false;speech="Beautiful breathing, gorgeous! \u{2728}";addSparkles(3);return}
  breathPhase='Breathe in... \u{1F338}';render();
  setTimeout(()=>{breathPhase='Hold... \u{2728}';render()},3000);
  setTimeout(()=>{breathPhase='Breathe out... \u{1F4A8}';render()},5000);
  setTimeout(()=>{breathCount=c+1;doBreath(c+1)},8000);
}

function renderMentor(){
  return '<div class="sec-title">\u{1F484} Glam Boost</div><div class="card"><div class="mentor-qt">"'+esc(pick(mentorQuotes))+'"</div></div><button class="btn-pink" onclick="speech=\'\u{1F484} Your Glam Mentor believes in you!\';addSparkles(1);section=\'mentor\';render()">Another Boost \u{1F484}</button>';
}

function loadGlam(){const q=pick(glamQuestions);glamQ=q;glamOpts=shuffle(q.options);glamResult=''}
function renderGlam(){
  if(!glamQ)return'';
  return '<div class="sec-title">\u{1F485} Glam Maths</div><div class="card"><div class="glam-q">'+esc(glamQ.q)+'</div><div class="glam-grid">'+glamOpts.map(o=>'<div class="glam-opt" onclick="checkGlam('+o+')">'+o+'</div>').join('')+'</div>'+(glamResult?'<div class="result-txt">'+glamResult+'</div>':'')+'</div><button class="btn-pink" onclick="loadGlam();render()">Next Question \u{1F485}</button>';
}
function checkGlam(ans){
  if(glamResult)return;
  if(ans===glamQ.a){glamResult='\u{1F389} Correct! You\'re a glam genius!';addSparkles(2)}
  else{glamResult='The answer was '+glamQ.a+'. Great try! \u{1F4AA}';render()}
}

function loadNewPuzzle(){const p=pick(puzzleWords);puzzle=p;puzzleLetters=shuffle(p.word.split(''));puzzleAnswer=[];puzzleUsed=[];puzzleResult=''}
function renderWord(){
  if(!puzzle)return'';
  return '<div class="sec-title">\u{1F48E} Word Sparkle</div><div class="card"><div class="hint-txt">Hint: '+esc(puzzle.hint)+'</div><div class="answer-row">'+puzzle.word.split('').map((_,i)=>'<div class="ans-slot">'+(puzzleAnswer[i]||'')+'</div>').join('')+'</div><div class="letter-row">'+puzzleLetters.map((l,i)=>'<div class="letter-tile'+(puzzleUsed.includes(i)?' used':'')+'" onclick="tapLetter(\''+l+'\','+i+')">'+l+'</div>').join('')+'</div>'+(puzzleResult?'<div class="result-txt">'+puzzleResult+'</div>':'')+'</div><button class="btn-purple" onclick="loadNewPuzzle();render()">New Word \u{1F48E}</button>';
}
function tapLetter(l,i){
  if(puzzleUsed.includes(i))return;
  puzzleAnswer.push(l);puzzleUsed.push(i);
  if(puzzleAnswer.length===puzzle.word.length){
    if(puzzleAnswer.join('')===puzzle.word){puzzleResult='\u{1F389} Sparkling! You got it!';addSparkles(2);return}
    else puzzleResult='The word was '+puzzle.word+'. Try again! \u{1F4AA}';
  }
  render();
}

function loadNewStory(){storySt=pick(storyStarters).replace(/SQUISH/g,ud.squishName||'Squish')}
function renderStory(){
  return '<div class="sec-title">\u{1F4D6} Story Studio</div><div class="card"><div class="story-start">'+esc(storySt)+'</div><textarea class="text-area" id="storyBox" placeholder="Continue the story..."></textarea></div><div class="btn-row"><button class="btn-pink" onclick="saveStory()">Save \u{2728}</button><button class="btn-purple" onclick="loadNewStory();render()">New Story</button></div>';
}
function saveStory(){
  const v=document.getElementById('storyBox').value.trim();
  if(!v){speech="Write something first! \u{1F4D6}";render();return}
  speech="Amazing story! You're so creative! \u{2728}";loadNewStory();addSparkles(3);
}

function loadNewSecret(){secret=pick(squishSecrets);ud.secretsCollected=(ud.secretsCollected||0)+1;ud.sparkles++;save()}
function renderSecrets(){
  return '<div class="sec-title">\u{1F31F} Squish Secrets</div><div class="secret-count">Secrets collected: '+(ud.secretsCollected||0)+'</div><div class="card"><div class="secret-txt">'+secret+'</div></div><button class="btn-pink" onclick="loadNewSecret();render()">Next Secret \u{1F31F}</button>';
}

function renderQuest(){
  return '<div class="sec-title">\u{2728} Daily Glow</div><div class="card"><div class="quest-txt">Today\'s sparkle mission!</div><div class="glam-q">Answer 3 Glam Maths questions! \u{1F485}</div></div><button class="btn-pink" onclick="speech=\'You did it! You\\\'re glowing! \u{2728}\u{1F389}\';addSparkles(5)">I did it! \u{2728}</button>';
}

// SATs
function satsK(subId,idx){return subId+'_'+idx}
function isSatsDone(subId,idx){return !!(sats[satsK(subId,idx)]?.done)}
function getSatsConf(subId,idx){return sats[satsK(subId,idx)]?.confidence||null}
function toggleSats(subId,idx){const k=satsK(subId,idx);sats[k]={...sats[k],done:!(sats[k]?.done)};saveSats();if(sats[k].done)addSparkles(2);else render()}
function setSatsConfidence(subId,idx,level){const k=satsK(subId,idx);sats[k]={...sats[k],confidence:level};saveSats();render()}
function satsPct(sub){let d=0;sub.topics.forEach((_,i)=>{if(isSatsDone(sub.id,i))d++});return Math.round((d/sub.topics.length)*100)}
function satsGlobalPct(){let t=0,d=0;SATS_SUBJECTS.forEach(s=>s.topics.forEach((_,i)=>{t++;if(isSatsDone(s.id,i))d++}));return t?Math.round((d/t)*100):0}

function renderSatsMain(){
  const gp=satsGlobalPct();
  return '<button class="back-btn" onclick="goBack()">\u{2190} Back</button><div class="sec-title">\u{1F4DA} SATs Revision</div><div class="prog-outer"><div class="prog-fill" style="width:'+gp+'%"></div></div><div class="prog-lbl">'+gp+'% complete</div><div class="sats-grid">'+SATS_SUBJECTS.map(sub=>{const p=satsPct(sub);return'<div class="sats-card" onclick="currentSatsSub=SATS_SUBJECTS.find(s=>s.id===\''+sub.id+'\');render()"><div class="sats-icon">'+sub.icon+'</div><div class="sats-nm">'+sub.name+'</div><div class="sats-cnt">'+sub.topics.length+' topics</div><div class="sats-bar-o"><div class="sats-bar-f" style="width:'+p+'%;background:'+sub.color+'"></div></div><div class="sats-pct">'+p+'%</div></div>'}).join('')+'</div>';
}

function renderSatsSub(){
  const sub=currentSatsSub;
  return '<button class="back-btn" onclick="goBackSats()">\u{2190} Back</button><div class="sec-title">'+sub.icon+' '+sub.name+'</div>'
  +sub.topics.map((topic,i)=>{
    const done=isSatsDone(sub.id,i),conf=getSatsConf(sub.id,i),exp=expandedTopic===i;
    const confs=[{l:'red',t:'\u{1F534} Not sure',bg:'#FFE0E0',bc:'#FF6B6B'},{l:'amber',t:'\u{1F7E1} Getting there',bg:'#FFF3D0',bc:'#FFB347'},{l:'green',t:'\u{1F7E2} Got it',bg:'#D5F5E3',bc:'#58D68D'}];
    return'<div class="topic-card"><div class="topic-row"><div class="chk'+(done?' done':'')+'" onclick="toggleSats(\''+sub.id+'\','+i+')">'+(done?'<span class="chk-mark">\u{2713}</span>':'')+'</div><div class="topic-nm'+(done?' done-txt':'')+'">'+esc(topic.name)+'</div><div class="notes-btn" onclick="expandedTopic='+(exp?'null':i)+';render()">'+(exp?'hide \u{25B4}':'notes \u{25BE}')+'</div></div>'
    +(exp?'<div class="notes-panel">'+topic.notes.map(n=>'<div class="note-txt">\u{2022} '+esc(n)+'</div>').join('')+(topic.tip?'<div class="tip-box"><div class="tip-txt">\u{1F4A1} '+esc(topic.tip)+'</div></div>':'')+'<div class="conf-row">'+confs.map(c=>'<div class="conf-btn" style="'+(conf===c.l?'background:'+c.bg+';border-color:'+c.bc:'')+'" onclick="setSatsConfidence(\''+sub.id+'\','+i+',\''+c.l+'\')">'+c.t+'</div>').join('')+'</div></div>':'')
    +'</div>'}).join('');
}

load();
</script>
</body>
</html>
